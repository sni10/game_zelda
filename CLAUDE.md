# CLAUDE.md

Этот файл предоставляет руководство для Claude Code (claude.ai/code) при работе с кодом в данном репозитории.

## Основные команды разработки

### Запуск игры
```bash
python main.py
```
Основная точка входа находится в корневой директории для удобства.

### Тестирование
```bash
# Запустить все тесты с покрытием
pytest tests/ -v --tb=short --cov=src --cov-report=xml --cov-report=term-missing

# Запустить конкретный тестовый файл
pytest tests/unit/test_player.py -v

# Запустить конкретный тестовый метод
pytest tests/unit/test_player.py::TestPlayer::test_movement -v
```

### Качество кода
```bash
# Форматирование кода
black src/ tests/

# Линтинг кода
flake8 src/ tests/

# Проверка типов
mypy src/
```

### Зависимости
```bash
# Установить все зависимости
pip install -r requirements.txt

# Установить для разработки (включает инструменты тестирования и линтинга)
pip install pygame pytest pytest-cov pytest-mock black flake8 mypy coverage
```

## Обзор архитектуры

Это 2D игра в стиле Zelda, построенная на Python и Pygame с соблюдением принципов ООП, SOLID и DRY.

### Основной архитектурный паттерн
Игра использует модульную entity-component систему с четким разделением обязанностей:
- Класс `Game` управляет основным игровым циклом и координирует все системы
- Конфигурация загружается из `config.ini` через систему `ConfigLoader`
- Все игровые настройки централизованы и валидированы по типу

### Ключевые системы
- **Управление конфигурацией**: `src/core/config_loader.py` обрабатывает валидацию и загрузку конфигурации
- **Игровой цикл**: `src/core/game.py` управляет основным игровым циклом с правильной обработкой delta time
- **Система сущностей**: Модульные сущности в `src/entities/` (Player, Enemy, NPC, Item)
- **Система мира**: `src/world/world.py` обрабатывает камеру, обнаружение коллизий и генерацию мира
- **Система отладки**: `src/utils/debug.py` предоставляет возможности отладки во время выполнения

### Ключевые паттерны проектирования
- **Композиция над наследованием**: Сущности составляются из поведений, а не глубокого наследования
- **Конфигурационно-ориентированный**: Все игровые параметры вынесены в `config.ini`
- **Delta Time**: Правильное движение, независимое от частоты кадров, с использованием delta time
- **Система камеры**: Мир 2000x2000 с плавным следованием камеры и ограничениями границ

## Текущие игровые возможности

### Система движения игрока
- **Движение по 8 направлениям**: WASD или стрелочки для движения в любом направлении
- **Нормализация скорости**: Правильная нормализация диагонального движения (120 пикселей/секунду)
- **Размер игрока**: 32x32 пикселя с индикатором направления взгляда (белая точка)
- **Плавное движение**: Независимое от частоты кадров движение с delta time

### Система атаки
- **Направленная атака**: Пробел для атаки в направлении взгляда
- **Визуальные эффекты**: Игрок краснеет во время атаки, желтая зона показывает область атаки
- **Механика времени**: 300мс продолжительность атаки, 100мс кулдаун
- **Зона поражения**: 40 пикселей дальность, 30x30 пикселей область атаки
- **Блокировка движения**: Во время атаки игрок не может двигаться

### Игровой мир
- **Большой открытый мир**: 2000x2000 пикселей для исследования
- **Случайные препятствия**: 150 коричневых препятствий различных размеров (1x1 или 2x2 тайла)
- **Система коллизий**: Столкновения с препятствиями и границами мира
- **Визуальная сетка**: Темно-зеленые линии сетки для лучшей ориентации
- **Безопасная зона спавна**: 100x100 пикселей свободной области в центре мира

### Система камеры и интерфейс
- **Умная камера**: Автоматическое центрирование на игроке с ограничениями границ
- **Мини-карта**: 150x150 пикселей в правом верхнем углу показывает:
  - Позицию игрока (красная точка)
  - Препятствия (серые точки) 
  - Область видимости камеры (желтая рамка)
- **Система отладки**: F1 для включения информации о координатах, FPS, состоянии игрока

### Управление
- **WASD или стрелочки**: Движение в 8 направлениях
- **Пробел**: Атака в направлении взгляда
- **F1**: Включить/выключить отладочную информацию
- **ESC**: Выход из игры

## Детали проекта

### Система конфигурации
Игра использует продвинутую систему конфигурации в `src/core/config_loader.py`:
- Валидирует все значения конфигурации при запуске
- Предоставляет типобезопасные аксессоры: `get_config()` и `get_color()`
- Централизована в `config.ini` с секциями для дисплея, мира, игрока, атаки, цветов, отладки и генерации мира

### Взаимосвязи сущностей
- `Player` (src/entities/player.py): Движение в 8 направлениях с правильной нормализацией диагональной скорости, система атаки с кулдауном
- `World` (src/world/world.py): Управляет следованием камеры, обнаружением коллизий, генерацией препятствий
- Все сущности следуют единообразным паттернам для позиции, размера и обнаружения коллизий

### Стратегия тестирования
Тесты организованы по типам:
- Юнит-тесты в `tests/unit/` тестируют отдельные компоненты изолированно
- Тесты конфигурации в `tests/config/` тестируют загрузку и валидацию конфигурации
- Директория интеграционных тестов существует для будущего кросс-компонентного тестирования

## Стратегия ветвления и CI/CD

Этот проект следует GitFlow:
- `main` - готовый к продакшену код
- `stage` - предпродакшн тестирование
- `dev` - интеграционная ветка для фич
- `feature/*` - новая функциональность на основе dev

### Автоматизированные процессы
1. **python-tests.yml**: Запускает тесты при push/PR в ветки main/dev/stage
2. **auto-sync-branches.yml**: Автоматически создает PR для dev→stage и stage→main
3. **versioning.yml**: Автоматически создает семантически версированные релизы при мерже в main

## Важные детали реализации

### Соображения производительности
- Игра работает на 60 FPS с delta time для независимости от частоты кадров
- Размер мира 2000x2000 пикселей с эффективным обнаружением коллизий
- Скорость игрока правильно нормализована для диагонального движения (120 пикселей/секунду)

### Система отладки
- Нажмите F1 для переключения отображения отладочной информации
- Утилиты отладки в `src/utils/debug.py` предоставляют информацию во время выполнения
- Конфигурация отладки контролируется через config.ini

### Схема управления
- WASD или стрелочки: Движение в 8 направлениях
- Пробел: Атака в направлении взгляда с кулдауном
- F1: Переключить отладочную информацию
- ESC: Выйти из игры

## Команды тестирования и линтинга

Всегда запускайте тесты и линтинг перед коммитом:
```bash
# Полный набор тестов с покрытием
pytest tests/ -v --cov=src --cov-report=term-missing

# Форматирование и линтинг кода
black src/ tests/
flake8 src/ tests/
mypy src/
```

CI/CD пайплайн будет автоматически запускать эти проверки на всех PR и push в основные ветки.