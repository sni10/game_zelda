### Понимание устройства тоннелей и пещер в игре

Да, я полностью понимаю вашу концепцию! Исходя из анализа технической документации и сценария игры, тоннели и пещеры действительно представляют собой **подслой тайлов на Z-уровне -1**, а не отдельные локации.

### Архитектурная концепция Z-уровней

#### Структура Z-координат:
- **Z = -1**: подземные тоннели, подвалы, пещеры
- **Z = 0**: базовый уровень игры (поверхность)
- **Z = +1**: мосты, крыши, верхушки деревьев

#### Принцип работы тоннелей:

**1. Не отдельные локации, а подслой**
- Тоннели существуют **внутри той же карты**, но на уровне Z=-1
- Игрок физически остается в той же локации, но перемещается "под землю"
- Поверхность (Z=0) продолжает существовать над игроком

**2. Входы через триггеры**
- Специальные тайлы-триггеры (`tunnel_entrance_hatch`) служат входами
- При взаимодействии игрок переходит с Z=0 на Z=-1
- Система `ZTransitionSystem` управляет плавными переходами

**3. Визуальное перекрытие**
- Травяные тайлы на Z=0 частично скрывают игрока в тоннеле
- `RenderingSystem` отрисовывает слои с правильной сортировкой
- Игрок виден "сквозь" полупрозрачные перекрывающие элементы

### Сюжетная интеграция

#### Пример из Пролога (Сцена 3: "Подземный побег"):
```
- Локация: village_map_destroyed
- Игрок на Z=-1, движется по escape_tunnel_path  
- На Z=0 происходят скриптовые события (бой орков и жителей)
- RenderingSystem отрисовывает оба уровня одновременно
```

#### Механика респавна в подвальных тоннелях:
- Игрок может появляться сразу на Z=-1 по сюжету
- Система сохраняет Z-позицию игрока
- Квестовые события могут принудительно перемещать на подземный уровень

### Технические особенности

#### Система коллизий:
- Коллизии происходят только между объектами на одном Z-уровне
- Игрок в тоннеле (Z=-1) не сталкивается с объектами на поверхности (Z=0)

#### Структура тоннелей:
- **Длина**: от 2 до 5 клеток
- **Ширина**: 2 клетки (узкий проход)
- **Стены**: ограничения движения по бокам
- **Путь**: заранее определенный маршрут

#### Визуальные эффекты:
- Затемненный рендеринг для подземного уровня
- Полупрозрачные перекрывающие элементы
- Анимации входа/выхода из тоннелей

### Игровые возможности

Эта система открывает уникальные геймплейные механики:

1. **Скрытное перемещение** - игрок может пройти под врагами незамеченным
2. **Многослойные головоломки** - события на разных Z-уровнях влияют друг на друга  
3. **Сюжетные переходы** - драматические сцены с переключением между уровнями
4. **Исследование** - секретные проходы и скрытые области

Ваша концепция тоннелей как подслоя тайлов является элегантным решением, которое сохраняет целостность игрового мира, избегая загрузки отдельных локаций, и создает ощущение настоящего трехмерного пространства в 2D игре.